<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kubernetes Test Results</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            min-height: 100vh;
            padding: 20px;
            color: #1e293b;
        }
        .container { max-width: 900px; margin: 0 auto; }
        .header {
            background: linear-gradient(135deg, #326ce5 0%, #0d47a1 100%);
            color: white;
            padding: 35px;
            border-radius: 20px 20px 0 0;
            text-align: center;
        }
        .header h1 { font-size: 2.2em; margin-bottom: 8px; }
        .header p { opacity: 0.9; font-size: 1.1em; }
        .score-panel {
            background: white;
            padding: 40px;
            text-align: center;
            border-bottom: 3px solid #e2e8f0;
        }
        .score-circle {
            width: 160px;
            height: 160px;
            border-radius: 50%;
            margin: 0 auto 25px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }
        .score-circle.pass { background: linear-gradient(135deg, #16a34a, #22c55e); color: white; }
        .score-circle.fail { background: linear-gradient(135deg, #dc2626, #ef4444); color: white; }
        .score-percent { font-size: 3em; line-height: 1; }
        .score-label { font-size: 1em; opacity: 0.9; margin-top: 5px; }
        .result-verdict {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .result-verdict.pass { color: #16a34a; }
        .result-verdict.fail { color: #dc2626; }
        .result-subtitle { color: #64748b; margin-bottom: 25px; }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 25px;
        }
        .stat-box {
            background: #f8fafc;
            border-radius: 12px;
            padding: 18px;
            text-align: center;
            border: 2px solid #e2e8f0;
        }
        .stat-value { font-size: 1.8em; font-weight: bold; color: #1e293b; }
        .stat-label { font-size: 0.85em; color: #64748b; margin-top: 4px; }
        .domain-section {
            background: white;
            padding: 30px;
            border-bottom: 3px solid #e2e8f0;
        }
        .domain-section h2 { font-size: 1.4em; margin-bottom: 20px; color: #1e293b; }
        .domain-row {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .domain-name { font-weight: 600; min-width: 220px; color: #334155; font-size: 0.95em; }
        .domain-bar-wrap { flex: 1; background: #e2e8f0; border-radius: 10px; height: 12px; min-width: 100px; }
        .domain-bar { height: 100%; border-radius: 10px; transition: width 0.8s ease; }
        .domain-score { font-weight: 700; min-width: 55px; text-align: right; font-size: 0.95em; }
        .review-section {
            background: white;
            padding: 30px;
        }
        .review-section h2 { font-size: 1.4em; margin-bottom: 20px; color: #1e293b; }
        .filter-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .filter-btn {
            padding: 8px 18px;
            border-radius: 20px;
            border: 2px solid #e2e8f0;
            background: white;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            color: #475569;
            transition: all 0.2s;
        }
        .filter-btn.active { background: #326ce5; color: white; border-color: #326ce5; }
        .review-card {
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            padding: 22px;
            margin-bottom: 18px;
            transition: all 0.2s;
        }
        .review-card.correct { border-color: #16a34a; background: #f0fdf4; }
        .review-card.incorrect { border-color: #dc2626; background: #fef2f2; }
        .review-card.skipped { border-color: #f59e0b; background: #fffbeb; }
        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
            gap: 10px;
            flex-wrap: wrap;
        }
        .review-meta { display: flex; gap: 8px; flex-wrap: wrap; }
        .r-badge {
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.78em;
            font-weight: 700;
        }
        .badge-correct { background: #dcfce7; color: #166534; }
        .badge-incorrect { background: #fee2e2; color: #991b1b; }
        .badge-skipped { background: #fef9c3; color: #854d0e; }
        .badge-domain-r { background: #f3e8ff; color: #6b21a8; }
        .badge-type-r { background: #dbeafe; color: #1e40af; }
        .result-icon { font-size: 1.4em; }
        .review-question { font-weight: 600; color: #1e293b; margin-bottom: 12px; line-height: 1.5; }
        .answer-row {
            display: flex;
            gap: 8px;
            align-items: flex-start;
            margin-bottom: 6px;
            font-size: 0.95em;
            flex-wrap: wrap;
        }
        .answer-label { font-weight: 700; min-width: 130px; color: #64748b; }
        .answer-value { color: #1e293b; }
        .answer-value.correct-val { color: #16a34a; font-weight: 600; }
        .answer-value.incorrect-val { color: #dc2626; font-weight: 600; }
        .explanation {
            background: #f1f5f9;
            border-left: 4px solid #326ce5;
            padding: 12px 15px;
            border-radius: 0 8px 8px 0;
            margin-top: 12px;
            font-size: 0.9em;
            color: #334155;
            line-height: 1.6;
        }
        .footer-actions {
            background: #1e3a5f;
            padding: 25px 30px;
            display: flex;
            justify-content: center;
            gap: 15px;
            border-radius: 0 0 20px 20px;
            flex-wrap: wrap;
        }
        .btn {
            padding: 13px 30px;
            border-radius: 10px;
            border: none;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-primary {
            background: linear-gradient(135deg, #326ce5, #0d47a1);
            color: white;
            box-shadow: 0 4px 12px rgba(50,108,229,0.3);
        }
        .btn-secondary { background: #e2e8f0; color: #475569; }
        .btn:hover { transform: translateY(-1px); }
        .no-results {
            text-align: center;
            padding: 60px;
            color: #64748b;
            background: white;
        }
        code {
            background: #f1f5f9;
            padding: 2px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>‚éà Kubernetes Test Results</h1>
        <p id="headerSubtitle">Basic Level ‚Äî CKA Foundation</p>
    </div>
    <div id="resultsContent"></div>
    <div class="footer-actions">
        <button class="btn btn-secondary" onclick="window.print()">üñ® Print Results</button>
        <button class="btn btn-primary" onclick="retakeTest()">üîÑ Retake Test</button>
    </div>
</div>

<script>
    const data = JSON.parse(localStorage.getItem('k8s_test_results') || 'null');

    if (!data) {
        document.getElementById('resultsContent').innerHTML = `
            <div class="no-results">
                <h2>No results found</h2>
                <p style="margin-top:10px">Please complete the test first.</p>
                <button class="btn btn-primary" style="margin-top:20px" onclick="window.location.href='kubernetes-basic-test.html'">Go to Test</button>
            </div>`;
    } else {
        renderResults(data);
    }

    function renderResults(data) {
        const { questions, answers, timeTaken } = data;
        let correct = 0, incorrect = 0, skipped = 0;
        const domainStats = {};

        questions.forEach((q, i) => {
            const domain = q.domain;
            if (!domainStats[domain]) domainStats[domain] = { correct: 0, total: 0 };
            domainStats[domain].total++;

            const userAnswer = answers[i];
            if (!userAnswer) { skipped++; return; }

            let isCorrect = false;
            if (q.type === 'fill') {
                isCorrect = userAnswer.trim().toLowerCase() === q.answer.toLowerCase();
            } else {
                isCorrect = userAnswer === q.answer;
            }

            if (isCorrect) { correct++; domainStats[domain].correct++; }
            else incorrect++;
        });

        const total = questions.length;
        const score = Math.round((correct / total) * 100);
        const passed = score >= 66;

        const domainColors = {
            'Cluster Architecture': '#326ce5',
            'Workloads & Scheduling': '#059669',
            'Services & Networking': '#d97706',
            'Storage': '#7c3aed',
            'Troubleshooting': '#dc2626'
        };

        let allCardsHTML = '';
        let currentFilter = 'all';

        function buildCards(filter) {
            return questions.map((q, i) => {
                const userAnswer = answers[i];
                let isCorrect = false;
                let status = 'skipped';

                if (userAnswer) {
                    if (q.type === 'fill') {
                        isCorrect = userAnswer.trim().toLowerCase() === q.answer.toLowerCase();
                    } else {
                        isCorrect = userAnswer === q.answer;
                    }
                    status = isCorrect ? 'correct' : 'incorrect';
                }

                if (filter !== 'all' && filter !== status) return '';

                const icon = status === 'correct' ? '‚úÖ' : status === 'incorrect' ? '‚ùå' : '‚ö†Ô∏è';
                const badgeClass = `badge-${status}`;
                const badgeText = status.charAt(0).toUpperCase() + status.slice(1);

                let userDisplay = userAnswer || '<em>Not answered</em>';
                let correctDisplay = q.answer;

                const userClass = isCorrect ? 'correct-val' : (userAnswer ? 'incorrect-val' : '');

                return `
                    <div class="review-card ${status}">
                        <div class="review-header">
                            <div class="review-meta">
                                <span class="r-badge ${badgeClass}">${badgeText}</span>
                                <span class="r-badge badge-domain-r">${q.domain}</span>
                                <span class="r-badge badge-type-r">${q.type.toUpperCase()}</span>
                            </div>
                            <span class="result-icon">${icon}</span>
                        </div>
                        <div class="review-question">Q${i+1}. ${q.question}</div>
                        <div class="answer-row">
                            <span class="answer-label">Your Answer:</span>
                            <span class="answer-value ${userClass}">${userDisplay}</span>
                        </div>
                        <div class="answer-row">
                            <span class="answer-label">Correct Answer:</span>
                            <span class="answer-value correct-val">${correctDisplay}</span>
                        </div>
                        <div class="explanation">üí° ${q.explanation}</div>
                    </div>
                `;
            }).join('');
        }

        const domainRowsHTML = Object.entries(domainStats).map(([domain, stats]) => {
            const pct = Math.round((stats.correct / stats.total) * 100);
            const color = domainColors[domain] || '#326ce5';
            return `
                <div class="domain-row">
                    <div class="domain-name">${domain}</div>
                    <div class="domain-bar-wrap">
                        <div class="domain-bar" style="width:${pct}%; background:${color}"></div>
                    </div>
                    <div class="domain-score" style="color:${color}">${stats.correct}/${stats.total} (${pct}%)</div>
                </div>
            `;
        }).join('');

        document.getElementById('resultsContent').innerHTML = `
            <div class="score-panel">
                <div class="score-circle ${passed ? 'pass' : 'fail'}">
                    <div class="score-percent">${score}%</div>
                    <div class="score-label">${passed ? 'PASSED' : 'FAILED'}</div>
                </div>
                <div class="result-verdict ${passed ? 'pass' : 'fail'}">${passed ? 'üéâ Congratulations!' : 'üìö Keep Studying'}</div>
                <div class="result-subtitle">${passed ? 'You passed the Basic Level test!' : 'You need 66% to pass. Review the topics below.'}</div>
                <div class="stats-grid">
                    <div class="stat-box"><div class="stat-value" style="color:#16a34a">${correct}</div><div class="stat-label">Correct</div></div>
                    <div class="stat-box"><div class="stat-value" style="color:#dc2626">${incorrect}</div><div class="stat-label">Incorrect</div></div>
                    <div class="stat-box"><div class="stat-value" style="color:#f59e0b">${skipped}</div><div class="stat-label">Skipped</div></div>
                    <div class="stat-box"><div class="stat-value">${score}%</div><div class="stat-label">Score</div></div>
                    <div class="stat-box"><div class="stat-value" style="color:#326ce5">${timeTaken}</div><div class="stat-label">Time Taken</div></div>
                </div>
            </div>

            <div class="domain-section">
                <h2>üìä Score by Domain</h2>
                ${domainRowsHTML}
            </div>

            <div class="review-section">
                <h2>üîç Question Review</h2>
                <div class="filter-bar">
                    <button class="filter-btn active" id="filter-all" onclick="applyFilter('all')">All (${total})</button>
                    <button class="filter-btn" id="filter-correct" onclick="applyFilter('correct')">‚úÖ Correct (${correct})</button>
                    <button class="filter-btn" id="filter-incorrect" onclick="applyFilter('incorrect')">‚ùå Incorrect (${incorrect})</button>
                    <button class="filter-btn" id="filter-skipped" onclick="applyFilter('skipped')">‚ö†Ô∏è Skipped (${skipped})</button>
                </div>
                <div id="reviewCards">${buildCards('all')}</div>
            </div>
        `;

        window.applyFilter = function(filter) {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('filter-' + filter).classList.add('active');
            document.getElementById('reviewCards').innerHTML = buildCards(filter);
        };
    }

    function retakeTest() {
        localStorage.removeItem('k8s_test_results');
        window.location.href = 'kubernetes-basic-test.html';
    }
</script>
</body>
</html>
